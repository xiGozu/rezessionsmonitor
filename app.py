# app.py
import streamlit as st
import pandas as pd
import numpy as np
import datetime
from sklearn.linear_model import LogisticRegression
import matplotlib.pyplot as plt

st.set_page_config(page_title="Rezessionsmonitor", layout="wide")
st.title("üîç Rezessions-Fr√ºhwarnsystem mit Prognose")

# --- Hilfsfunktionen ---
def fetch_sample_data():
    today = datetime.date.today()
    dates = pd.date_range(end=today, periods=6, freq='M')
    data = pd.DataFrame({
        "Datum": dates,
        "EMI": [49, 48, 47, 46, 45, 44],
        "Arbeitslosenquote": [5.1, 5.3, 5.4, 5.6, 5.9, 6.1],
        "Zinskurve": [0.3, 0.1, -0.2, -0.4, -0.6, -0.8],
        "Industrieproduktion": [1.2, 0.8, 0.5, -0.3, -1.1, -2.0]
    })
    return data

# --- Fr√ºhwarn-Indikatoren ---
st.subheader("Fr√ºhwarn-Indikatoren")
df = fetch_sample_data()
st.dataframe(df.set_index("Datum"))

# --- Erl√§uterung der Fr√ºhwarn-Indikatoren ---
st.markdown("""
### üìò Beschreibung der Fr√ºhwarn-Indikatoren

**EMI (Einkaufsmanagerindex):**  
Ein zentraler Fr√ºhindikator f√ºr die wirtschaftliche Aktivit√§t in der Industrie. Werte √ºber 50 signalisieren Expansion, Werte unter 50 Schrumpfung.  
**Rezessionssignal:** Bei einem anhaltenden R√ºckgang unter 47 √ºber mehrere Monate steigt die Rezessionswahrscheinlichkeit deutlich.

**Arbeitslosenquote:**  
Gibt den prozentualen Anteil der arbeitslosen Personen an der Erwerbsbev√∂lkerung an. Ein konstanter Anstieg √ºber mehrere Monate signalisiert wirtschaftliche Schw√§che.  
**Rezessionssignal:** Steigt die Quote um mehr als 0,5 Prozentpunkte innerhalb von 3‚Äì6 Monaten, gilt das als Warnzeichen.

**Zinskurve (10J - 2J Staatsanleihen):**  
Differenz zwischen langfristigen und kurzfristigen Zinss√§tzen. Eine normale Kurve ist positiv (langfristige Zinsen h√∂her). Eine inverse Zinskurve (negative Werte) zeigt, dass Investoren kurzfristig h√∂here Risiken sehen.  
**Rezessionssignal:** Eine invertierte Kurve √ºber mehrere Wochen (z.‚ÄØB. < -0,25 %) war in der Vergangenheit ein sehr verl√§sslicher Fr√ºhindikator.

**Industrieproduktion (Ver√§nderung gg√º. Vorjahr):**  
Misst die reale Produktion der Industrie im Vergleich zum Vorjahresmonat. R√ºckg√§nge deuten auf sinkende Nachfrage und reduzierte Wirtschaftst√§tigkeit hin.  
**Rezessionssignal:** Wenn der Wert drei Monate in Folge negativ ist (unter 0‚ÄØ%), ist dies ein starkes Alarmsignal.
""")

# --- Prognosemodell (vereinfachtes Beispiel) ---
df_model = df.copy()
df_model["Rezession"] = (df_model["Industrieproduktion"] < 0).astype(int)
features = ["EMI", "Arbeitslosenquote", "Zinskurve"]
X = df_model[features]
y = df_model["Rezession"]
model = LogisticRegression()
model.fit(X, y)

# Aktuelle Werte zur Prognose
aktuell = df_model.iloc[-1][features].values.reshape(1, -1)
p_rezession = model.predict_proba(aktuell)[0][1]

st.subheader("üî¢ Rezessionswahrscheinlichkeit")
st.metric(label="Deutschland / Eurozone (vereinfachtes Modell)", value=f"{p_rezession*100:.1f} %", delta=None)

# --- Ampelanzeige ---
st.subheader("üö® Risikobewertung")
ampel = "üî¥ Hoch" if p_rezession > 0.6 else ("üü° Mittel" if p_rezession > 0.3 else "üü¢ Niedrig")
st.markdown(f"**Aktuelles Rezessionsrisiko:** {ampel}")

# --- Zeitprognose f√ºr m√∂gliche n√§chste Rezession ---
st.subheader("üìÖ Gesch√§tzter Zeitpunkt einer m√∂glichen Rezession")
heute = datetime.date.today()
if p_rezession > 0.6:
    prog_date = heute + datetime.timedelta(days=90)
    st.markdown(f"Basierend auf den aktuellen Daten ist eine Rezession bis **{prog_date.strftime('%B %Y')}** wahrscheinlich.")
elif p_rezession > 0.3:
    prog_date = heute + datetime.timedelta(days=180)
    st.markdown(f"Eine Rezession ist m√∂glich bis **{prog_date.strftime('%B %Y')}**, falls sich der Trend verst√§rkt.")
else:
    st.markdown("Aktuell keine konkrete Rezession in Sicht ‚Äì jedoch Beobachtung empfohlen.")

# --- Empfehlungen f√ºr rezessionsresistente Sektoren ---
st.subheader("üìà Sektor-Empfehlungen bei Rezessionsgefahr")
if p_rezession > 0.6:
    st.markdown("""
    Bei hohem Rezessionsrisiko gelten folgende Bereiche als relativ widerstandsf√§hig:

    - **Basiskonsum (Consumer Staples):** Lebensmittel, Haushaltswaren, Hygieneprodukte  
      *Beispiele:* Nestl√©, Procter & Gamble, Unilever
    
    - **Gesundheitswesen (Healthcare):** Medikamente, Krankenh√§user, Medizintechnik  
      *Beispiele:* Pfizer, Roche, Johnson & Johnson

    - **Versorger (Utilities):** Strom, Wasser, Gas ‚Äì stabile Einnahmen durch Grundversorgung  
      *Beispiele:* E.ON, RWE, NextEra Energy

    - **Gold & Edelmetalle:** Stabil in Krisenzeiten ‚Äì profitieren von Unsicherheit und fallenden Realzinsen

    - **Hochqualitative Staatsanleihen:** Besonders bei erwarteten Zinssenkungen attraktiv
    """)
elif p_rezession > 0.3:
    st.markdown("""
    Es besteht ein moderates Risiko f√ºr eine wirtschaftliche Abschw√§chung. Folgende Sektoren k√∂nnten bereits stabilisierend wirken:

    - **Basiskonsum & Gesundheit:** Erste Umschichtungen in defensivere Titel sind m√∂glich
    - **Cash & Geldmarkt-ETFs:** Erh√∂hte Liquidit√§t sorgt f√ºr Flexibilit√§t
    - **Gro√üe Technologieunternehmen mit stabilen Ertr√§gen:** z.‚ÄØB. Microsoft, Apple
    """)
else:
    st.markdown("""
    Derzeit kein akuter Handlungsbedarf. Zyklische Branchen wie Industrie, Technologie und Konsumg√ºter profitieren bei Wachstum.
    Dennoch sollte ein schrittweiser Aufbau defensiver Positionen langfristig erwogen werden.
    """)

# --- Legende und Hinweise ---
st.markdown("---")
st.caption("Fr√ºhwarn-Indikatoren basieren derzeit auf statischen Werten. Live-Integration folgt.")
